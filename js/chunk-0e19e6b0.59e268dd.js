(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0e19e6b0"],{"88f0":function(t,e,a){"use strict";a.r(e);var i={watch:{adv_modal:function(t){t&&(this.Adv.pageIndex=1,this.advTotal=0,this.getAdv())},eq_modal:function(t){t&&(this.Eq.pageIndex=1,this.eqTotal=0,this.getEq())}},data:function(){return{ruleValidate:{SName:[{required:!0,message:"请输入策略名称",trigger:"blur"}],Advertisers:[{required:!0,message:"请输入广告主名称",trigger:"blur"}]},loading:!1,GroupList:[],eq_modal:!1,adv_modal:!1,advTotal:0,eqTotal:0,BeginDate:"",EndDate:"",form:{SName:"",Advertisers:"",BeginDate:"",EndDate:"",Remark:"",MachineIdList:[],MaterialIdList:[]},Adv:{search:"",pageSize:10,pageIndex:1},Eq:{search:"",groupId:"",pageSize:10,pageIndex:1},adv:[],eq:[],adv_columns:[{type:"selection",width:60,align:"center"},{title:"素材名称",key:"MatName"},{title:"素材类型",key:"MatTypeName",width:160}],adv_columns_sele:[{title:"图片",slot:"URL"},{title:"素材名称",key:"MatName"},{title:"操作",slot:"action",width:100}],eq_columns:[{type:"selection",width:60,align:"center"},{title:"设备名称",key:"MachineName"},{title:"设备编号",key:"MachineCode"},{title:"点位",key:"PositionName"}],eq_columns_sele:[{title:"设备名称",key:"MachineName"},{title:"设备编号",key:"MachineCode"},{title:"操作",slot:"action",width:100}],adv_sele:[],eq_sele:[]}},created:function(){this.$route.params.id&&(this.form.Id=this.$route.params.id,this.editInit())},methods:{editInit:function(){var t=this;this.$api("GET","/Material/GetAdvertStrategyInfo?id=".concat(this.form.Id)).then(function(e){0===e.ErrorCode&&(t.form.SName=e.Data.SName,t.form.Advertisers=e.Data.Advertisers,t.form.BeginDate=e.Data.BeginDate,t.form.EndDate=e.Data.EndDate,t.BeginDate=e.Data.BeginDate,t.EndDate=e.Data.EndDate,t.form.Remark=e.Data.Remark,delete t.form.MachineIdList,delete t.form.MaterialIdList,t.eq_sele=e.Data.MachineList,t.adv_sele=e.Data.MaterialList)})},EndDateChange:function(t){this.form.EndDate=t},BeginDateChange:function(t){this.form.BeginDate=t},onSelectChangeAdv:function(t){this.adv_sele=t},onSelectChangeEq:function(t){this.eq_sele=t},advHandle:function(){this.adv_modal=!this.adv_modal},eqHandle:function(){this.eq_modal=!this.eq_modal},getEq:function(){var t=this;this.loading=!0,this.$api("POST","/Material/GetMachineInfoList",this.Eq).then(function(e){t.loading=!1,0===e.ErrorCode?(1==t.Eq.pageIndex?(t.GroupList=e.Data.GroupList,t.eq=e.Data.List):t.eq=t.eq.concat(e.Data.List),t.Eq.pageIndex++,t.eqTotal=e.Total):t.$Notice.warning({title:"系统提示",desc:e.Message})})},getAdv:function(){var t=this;this.loading=!0,this.$api("POST","/Material/GetMaterialInfoList",this.Adv).then(function(e){t.loading=!1,0===e.ErrorCode?(1==t.Adv.pageIndex?t.adv=e.Data.List:t.adv=t.adv.concat(e.Data.List),t.Adv.pageIndex++,t.advTotal=e.Total):t.$Notice.warning({title:"系统提示",desc:e.Message})})},save:function(){var t=this;this.$refs.ruleValidate.validate(function(e){if(e){if(""==t.form.BeginDate||""==t.form.EndDate)return void t.$Notice.warning({title:"系统提示",desc:"请填写开始日期和结束日期"});var a="";if(t.form.Id)a="/Material/UpadateAdvertStrategyInfo";else{if(a="/Material/AddAdvertStrategyInfo",!t.adv_sele.length)return void t.$Notice.warning({title:"系统提示",desc:"请添加素材"});if(t.form.MaterialIdList=t.adv_sele.map(function(t){return t.MaterialId}),!t.eq_sele.length)return void t.$Notice.warning({title:"系统提示",desc:"请添加设备"});t.form.MachineIdList=t.eq_sele.map(function(t){return t.MachineId})}t.$api("POST",a,t.form).then(function(e){0===e.ErrorCode?(t.$Notice.success({title:"系统提示",desc:"操作成功"}),t.form.Id||t.back()):t.$Notice.warning({title:"系统提示",desc:e.Message})})}else t.$Notice.warning({title:"系统提示",desc:"请填写相关的信息"})})},adv_handle:function(t){var e=this;if(this.form.Id){var a=[].concat(this.adv_sele);-1!==t&&a.splice(t,1);var i=a.map(function(t){return t.MaterialId});this.$api("POST","/Material/UpadateAdvertStrategyMaterial",{Id:this.form.Id,MaterialIdList:i}).then(function(a){0===a.ErrorCode?(e.$Notice.success({title:"系统提示",desc:"操作成功"}),-1!==t&&e.adv_sele.splice(t,1)):e.$Notice.warning({title:"系统提示",desc:a.Message})})}else-1!==t&&this.adv_sele.splice(t,1),this.$Notice.success({title:"系统提示",desc:"操作成功"})},eq_handle:function(t){var e=this;if(this.form.Id){var a=[].concat(this.eq_sele);-1!==t&&a.splice(t,1);var i=a.map(function(t){return t.MachineId});this.$api("POST","/Material/UpdateAdvertStrategyMachine",{Id:this.form.Id,MachineIdList:i}).then(function(a){0===a.ErrorCode?(e.$Notice.success({title:"系统提示",desc:"操作成功"}),-1!==t&&e.eq_sele.splice(t,1)):e.$Notice.warning({title:"系统提示",desc:a.Message})})}else-1!==t&&this.eq_sele.splice(t,1),this.$Notice.success({title:"系统提示",desc:"操作成功"})},back:function(){this.$router.go(-1)}}},s=(a("eba6"),a("2877")),n=Object(s.a)(i,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"info"},[a("Card",{style:{marginBottom:"30px"}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("基本信息")]),a("div",{staticClass:"good-form"},[a("Form",{ref:"ruleValidate",attrs:{rules:t.ruleValidate,model:t.form,"label-position":"left","label-width":90}},[a("Row",{attrs:{gutter:30,type:"flex",justify:"end"}},[a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"策略名称",prop:"SName"}},[a("Input",{attrs:{placeholder:"请输入策略名称"},model:{value:t.form.SName,callback:function(e){t.$set(t.form,"SName",e)},expression:"form.SName"}})],1)],1),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"广告主名称",prop:"Advertisers"}},[a("Input",{attrs:{placeholder:"请输入广告主名称"},model:{value:t.form.Advertisers,callback:function(e){t.$set(t.form,"Advertisers",e)},expression:"form.Advertisers"}})],1)],1)],1),a("Row",{attrs:{gutter:30,type:"flex",justify:"end"}},[a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"开始日期"}},[a("DatePicker",{staticStyle:{width:"100%"},attrs:{value:t.BeginDate,format:"yyyy-MM-dd",type:"date",placeholder:"请选择日期"},on:{"on-change":t.BeginDateChange}})],1)],1),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"结束日期"}},[a("DatePicker",{staticStyle:{width:"100%"},attrs:{value:t.EndDate,format:"yyyy-MM-dd",type:"date",placeholder:"请选择日期"},on:{"on-change":t.EndDateChange}})],1)],1)],1),a("Row",{attrs:{gutter:30,type:"flex"}},[a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{label:"备注"}},[a("Input",{attrs:{type:"textarea",rows:3,placeholder:""},model:{value:t.form.Remark,callback:function(e){t.$set(t.form,"Remark",e)},expression:"form.Remark"}})],1)],1)],1)],1)],1)])],1),a("div",{staticClass:"info"},[a("Card",{staticClass:"section"},[a("div",{staticClass:"clear",attrs:{slot:"title"},slot:"title"},[a("p",{staticClass:"fl",style:{width:"auto"}},[t._v("素材")]),a("Button",{staticClass:"fr",attrs:{size:"small",type:"info"},on:{click:t.advHandle}},[t._v("增加")])],1),a("div",{staticClass:"cont"},[t.adv_sele.length?a("Table",{attrs:{border:"",columns:t.adv_columns_sele,data:t.adv_sele},scopedSlots:t._u([{key:"URL",fn:function(t){var e=t.row;return t.index,[a("img",{staticClass:"adv_img",attrs:{src:e.URL}})]}},{key:"action",fn:function(e){e.row;var i=e.index;return[a("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){return t.adv_handle(i)}}},[t._v("删除")])]}}])}):a("p",{staticClass:"tip"},[t._v("暂无素材，请点击右上方增加按钮添加素材")])],1)]),a("Card",{staticClass:"section"},[a("div",{staticClass:"clear",attrs:{slot:"title"},slot:"title"},[a("p",{staticClass:"fl",style:{width:"auto"}},[t._v("设备")]),a("Button",{staticClass:"fr",attrs:{size:"small",type:"info"},on:{click:t.eqHandle}},[t._v("增加")])],1),a("div",{staticClass:"cont"},[t.eq_sele.length?a("Table",{attrs:{border:"",columns:t.eq_columns_sele,data:t.eq_sele},scopedSlots:t._u([{key:"action",fn:function(e){e.row;var i=e.index;return[a("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){return t.eq_handle(i)}}},[t._v("删除")])]}}])}):a("p",{staticClass:"tip"},[t._v("暂无设备，请点击右上方增加按钮添加设备")])],1)])],1),a("div",{staticClass:"handle clear"},[a("Button",{style:{marginRight:"14px"},on:{click:t.back}},[t._v("返回")]),a("Button",{attrs:{type:"info"},on:{click:t.save}},[t._v("保存")])],1),a("Modal",{attrs:{width:"700",title:"选择素材"},on:{"on-ok":function(e){return t.adv_handle(-1)}},model:{value:t.adv_modal,callback:function(e){t.adv_modal=e},expression:"adv_modal"}},[a("div",{staticClass:"table-section"},[a("Table",{attrs:{"max-height":"600",loading:t.loading,border:"",columns:t.adv_columns,data:t.adv},on:{"on-selection-change":t.onSelectChangeAdv}})],1),t.advTotal&&t.advTotal>t.adv.length?a("div",{staticClass:"more"},[a("Button",{attrs:{type:"info",loading:t.loading,long:""},on:{click:t.getAdv}},[t._v("加载更多")])],1):t._e()]),a("Modal",{attrs:{width:"800",title:"选择设备"},on:{"on-ok":function(e){return t.eq_handle(-1)}},model:{value:t.eq_modal,callback:function(e){t.eq_modal=e},expression:"eq_modal"}},[a("div",{staticClass:"table-section"},[a("Table",{attrs:{"max-height":"600",loading:t.loading,border:"",columns:t.eq_columns,data:t.eq},on:{"on-selection-change":t.onSelectChangeEq}})],1),t.eqTotal&&t.eqTotal>t.eq.length?a("div",{staticClass:"more"},[a("Button",{attrs:{type:"info",loading:t.loading,long:""},on:{click:t.getEq}},[t._v("加载更多")])],1):t._e()])],1)},[],!1,null,"00e47f1f",null);e.default=n.exports},adaa:function(t,e,a){},eba6:function(t,e,a){"use strict";var i=a("adaa");a.n(i).a}}]);